# Tabsbar Component  Line-by-Line Explanation

This file defines a UI component called tabsbar. It uses a shadow DOM, handles tabs and task manager rendering, and supports communication via a custom protocol.


- Loads the STATE module — this likely manages local or shared application state.

```js

const state = require('STATE')

```

- Initializes a new state DB instance for the current module file.

```js
const state_db = state(__filename)
```

- Extracts the sdb (state database) and get method. If no valid state exists, it falls back to fallback_module() function.
```js

const { sdb, get } = state_db(fallback_module)
```


---

## Required Components

- Imports the tabs_component and task_manager, which will be rendered inside the UI.
```js
const tabs_component = require('tabs')
const task_manager = require('task_manager')

```

---

##  Exporting the Main Function

- Exports the tabsbar function so it can be used in other files.
```js 
module.exports = tabsbar
```
---


## Inside the tabsbar Function

- The main function that builds the tabsbar UI.
- It accepts two parameters:

  -  opts: contains options like sid (session ID).
  -  protocol: an optional function for message communication.


```js
async function tabsbar (opts, protocol) {
```

### What’s inside opts?
- opts looks like this:

```js
  sid= Symbol(...),
  type= 'page>../src/node_modules/theme_widget>taskbar>tabsbar'
  >[Prototype]: object            
```
 - sid: a unique identifier (likely a Symbol) representing the current session.

- type: describes the widget/component path/type.ing this


---
```js
const { id, sdb } = await get(opts.sid)
```
This line retrieves data from the state DB using the session ID (sid).

It returns:

- id: the numeric ID of the session ('page>../src/node_modules/theme_widget>taskbar>tabsbar:0'
).

- sdb: a session-level object that contains properties like:

  - drive: for accessing files like styles and icons.

  - watch: a method to observe data changes.

  - potentially others depending on the state model.



```js
const {drive} = sdb
```
- drive is extracted from sdb. It provides access to file-like resources.

- You'll later use it to fetch:

  - Stylesheets (style/theme.css)

  - SVG icons (icons/1.svg, etc.)


---

## Injecting Styles and Icons in the Tabsbar Component

This section explains how styles and icons are injected into the Shadow DOM of the `tabsbar` UI component using handler functions and fallback-defined resources.

---

### `on` Object — Type to Function Mapping

The `on` object maps incoming data types (like `style` or `icons`) to corresponding handler functions.


- This object is passed to the state database watcher:

```js
const subs = await sdb.watch(onbatch)
```

- So when the state updates with style or icons, the respective function will be triggered.

### The Injection Functions
These are the handler functions for style and icon injection:

```js
function inject (data) {
    style.innerHTML = data.join('\n')
  }

  function inject_icons (data) {
    dricons = data
  }
}
```


- inject(data): Takes an array of CSS rules and joins them to inject into the Shadow DOM’s `<style>` tag.

- inject_icons(data): Stores raw SVG icon data (as an array) into the dricons variable for later use in the buttons.
  
### What Data Is Injected?
The inject() function receives an array of style rules like this:
    
```js
    
HERE IN 1ST FUNCTION IN DATA WE GOT 

              .tabs-bar-container {
                display: flex;
                flex: inherit;
                flex-direction: row;
                flex-wrap: nowrap;
                align-items: stretch;
              }
              .tabs-bar {
                display: flex;
                flex: auto;
                flex-direction: row;
                flex-wrap: nowrap;
                align-items: stretch;
                width: 300px;
              }
              .hat-btn, .bar-btn {
                display: flex;
                min-width: 32px;
                border: none;
                background: #131315;
                cursor: pointer;
                flex-direction: row;
                justify-content: center;
                align-items: center;
                padding: 4px 8px;
              }
              .hat-btn:hover, .bar-btn:hover {
                background:rgb(190, 190, 200);;
              }
            `
    ```

### Where This Style Comes From
These styles are defined in the fallback module:

```js
 drive: {
        'style/': {
          'theme.css': {
            raw: `
              .tabs-bar-container {
                display: flex;
                flex: inherit;
                flex-direction: row;
                flex-wrap: nowrap;
                align-items: stretch;
              }
              .tabs-bar {
                display: flex;
                flex: auto;
                flex-direction: row;
                flex-wrap: nowrap;
                align-items: stretch;
                width: 300px;
              }
              .hat-btn, .bar-btn {
                display: flex;
                min-width: 32px;
                border: none;
                background: #131315;
                cursor: pointer;
                flex-direction: row;
                justify-content: center;
                align-items: center;
                padding: 4px 8px;
              }
              .hat-btn:hover, .bar-btn:hover {
                background:rgb(190, 190, 200);;
              }
            `
          }
        },
```

and in 2nd function
### INJECT_ICONS Function


- data is an array of raw SVG XML strings.

- It assigns the icon data to a shared variable dricons so they can be parsed and used later in the DOM.
 
#### Example Icon Data Received
- A simplified example of what is inside data:
```js
<svg width="19" height="19" ...."></svg>,
<svg width="19" height="19" ...."></svg>,
<svg width="14" height="15" ...."></svg>

```

This data is stored as an array of SVG strings like:

```js
dricons = [
  '<svg>...</svg>', // Used for hat_btn
  '<svg>...</svg>', // Possibly unused
  '<svg>...</svg>'  // Used for bar_btn
]

```
#### Parsing and Injecting SVGs into Buttons

```js
   if (dricons[0]) {
    const parser = new DOMParser()
    const doc = parser.parseFromString(dricons[0], 'image/svg+xml')
    const svgElem = doc.documentElement
    hat_btn.replaceChildren(svgElem)
  }
  if (dricons[2]) {
    const parser = new DOMParser()
    const doc = parser.parseFromString(dricons[2], 'image/svg+xml')
    const svgElem = doc.documentElement
    bar_btn.replaceChildren(svgElem)
  }
 ```

- DOMParser is used to parse the raw SVG string into a DOM object.

- replaceChildren(svgElem) clears any existing content inside the button and inserts the new SVG.

- dricons[0] is used for hat_btn, and dricons[2] is used for bar_btn. 

--- 